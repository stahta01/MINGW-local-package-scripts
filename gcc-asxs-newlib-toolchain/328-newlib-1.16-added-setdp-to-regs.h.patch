From 3a8797c698d6f0845f349c0c8e902fae7efc348d Mon Sep 17 00:00:00 2001
From: dfffffff <dflamand@gmail.com>
Date: Fri, 17 Jun 2016 06:01:05 -0400
Subject: [PATCH 27/37] added setdp() to regs.h

---
 newlib/libc/machine/m6809/include/machine/regs.h | 13 ++++++++++---
 1 file changed, 10 insertions(+), 3 deletions(-)

diff --git a/newlib/libc/machine/m6809/include/machine/regs.h b/newlib/libc/machine/m6809/include/machine/regs.h
index 8faba0e..bed93c3 100644
--- a/newlib/libc/machine/m6809/include/machine/regs.h
+++ b/newlib/libc/machine/m6809/include/machine/regs.h
@@ -1,4 +1,3 @@
-
 #ifndef __M6809_REGS_H
 #define __M6809_REGS_H
 
@@ -31,9 +30,17 @@ extern inline unsigned int getstack (void)
 }
 
 
-extern inline void setdp (const unsigned short dp)
+extern inline void setdp (const unsigned char dp)
+{
+	asm __volatile__ ("tfr\t%0,dp" :: "q" (dp));
+}
+
+
+extern inline unsigned char getdp (void)
 {
-	asm __volatile__ ("tfr\tb, dp" :: "q" (dp));
+	unsigned char result;
+	asm __volatile__ ("tfr\tdp,%0" : "=q" (result));
+	return result;
 }
 
 
-- 
2.19.1.windows.1

